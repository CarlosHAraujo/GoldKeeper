<form [formGroup]="form" (ngSubmit)="onSubmit()" #formDir="ngForm">
  <label>Company</label>
  <div class="input-group">
    <input
      *ngIf="newCompany"
      type="text"
      class="form-control"
      formControlName="companyName"
      [class.is-invalid]="companyName.invalid && (companyName.dirty || companyName.touched || formDir.submitted)">
    <select
      *ngIf="!newCompany"
      class="form-control"
      formControlName="companyId"
      [class.is-invalid]="companyId.invalid && (companyId.dirty || companyId.touched || formDir.submitted)">
      <option [ngValue]="null">Company</option>
      <option *ngFor="let company of companies$ | async" [value]="company.id">{{company.name}}</option>
    </select>
    <div class="input-group-append text-monospace">
      <button *ngIf="!newCompany" class="btn btn-outline-primary" type="button" (click)="onNewCompanyClicked()">+</button>
      <button *ngIf="newCompany" class="btn btn-outline-primary" type="button" (click)="onNewCompanyClicked()">-</button>
    </div>
  </div>
  <div class="form-group">
    <label for="date">Date</label>
    <input
      type="datetime-local"
      class="form-control"
      placeholder="date/time"
      formControlName="date"
      [class.is-invalid]="date.invalid && (date.dirty || date.touched || formDir.submitted)">
    <div class="invalid-feedback">Date/time is Required.</div>
  </div>
  <div class="form-group">
    <label for="discount">Discount</label>
    <input type="number" class="form-control" placeholder="discount" formControlName="discount">
  </div>
  <label for="Items">Items</label>
  <div class="mb-3">
    <app-item-add
      [form]="itemForm"
      [invalid]="items.invalid && formDir.submitted"
      [products$]="products$"
      [addMode]="true"
      (added)="addItem(itemForm)">
    </app-item-add>
  </div>
  <div class="mb-3" formArrayName="items" *ngFor="let item of items.controls; let i=index;">
    <app-item-add
      [form]="item"
      [products$]="products$"
      [addMode]="false"
      (deleted)="deleteItem(i)">
    </app-item-add>
  </div>
  <label for="Payments">Payments</label>
  <div class="mb-3">
    <app-payment-add
      [form]="paymentForm"
      [invalid]="payments.invalid && formDir.submitted"
      [addMode]="true"
      [paymentMethods$]="paymentMethods$"
      (added)="addPayment(paymentForm)">
    </app-payment-add>
  </div>
  <div class="mb-3" formArrayName="payments" *ngFor="let payment of payments.controls; let i=index">
    <app-payment-add
      [form]="payment"
      [addMode]="false"
      [paymentMethods$]="paymentMethods$"
      (deleted)="deletePayment(i)">
    </app-payment-add>
  </div>
  <label for="extraCosts">Extra Costs</label>
  <div class="mb-3">
    <app-extra-cost-add
      [form]="extraCostForm"
      [invalid]="extraCosts.invalid && formDir.submitted"
      [addMode]="true"
      (added)="addExtraCost(extraCostForm)">
    </app-extra-cost-add>
  </div>
  <div class="mb-3" formArrayName="extraCosts" *ngFor="let extraCost of extraCosts.controls; let i=index">
    <app-extra-cost-add
      [form]="extraCost"
      [addMode]="false"
      (deleted)="deleteExtraCost(i)">
    </app-extra-cost-add>
  </div>
  <button class="btn btn-primary">Submit</button>
</form>
